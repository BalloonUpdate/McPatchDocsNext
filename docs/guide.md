# 简明教程

## 一、下载文件

在开始安装之前，要提前下载好这些文件：

1. mcpatch-manager.exe：这是管理端，用来打更新包
2. mcpatch-client.exe：这是客户端，用来更新下载更新文件

## 二、配置管理端

管理端是用来打包和管理更新包的工具，同时也提供一个内置的服务端功能，提供开箱即用的下载体验。

将管理端放到一个新建的目录mp中，然后打开终端，我们需要在终端里启动管理端。

第一次输入`mcpatch-manager.exe`不带任何参数运行，会输出帮助信息和生成工作空间目录workspace，这样管理端就配置好了。

## 三、放入要更新的文件

只把需要更新的文件放到工作空间目录里，暂时不更新的文件可以以后再放，能减少更新包的大小。

同时工作空间目录下的文件要和客户端保持相同的目录结构。

下面一些栗子可以参考（不存在的文件夹需要手动创建）：

+ 要更新所有模组，复制`.minecraft/mods`目录
  + 到`mp/workspace/.minecraft/mods`

+ 要更新.minecraft目录旁边的`新玩家进服教程.txt`，复制`新玩家进服教程.txt`文件
  + 到`mp/workspace/新玩家进服教程.txt`

+ 如果你开了版本隔离，就需要复制`.minecraft/versions/your-version/mods`目录
  + 到`mp/workspace/.minecraft/versions/your-version/mods`
  + 其它文件也是同理，需要复制到versions目录下

::: tip
若开启版本隔离，那么要更新的实际上是versions目录下的mods文件夹，把文件放到`.minecraft/mods`目录下，游戏是读取不到的。
:::

## 四、开始打包

在终端里输入`mcpatch-manager.exe pack <version>`即可开始打包，`<version>`是要打包的版本号，不能和现有的冲突。

版本号只能包括大小写字母，数字，以及`!@#$()_+-=;',.`这几个符号，不要使用中文，空格，或其它字符，会出问题。

如果你想给这个版本增加更新记录的话，把更新记录写在管理端目录的`logs.txt`文件里就会自动读取到了（使用utf-8编码）。

看到“打包完成！”的字样即代表打包成功了，更新包会存放在public目录下，会按版本号进行命名。

如果对打包结果不放心，可以使用`mcpatch-manager.exe test`对更新包进行校验，这会模拟客户端的解压过程，检查文件是否损坏。

::: warning

已经打好的更新包文件不能手动删除也不能修改里面的文件，这会导致数据损坏，应该再打一个新的包来替代删除旧的包。

:::

## 五、后续打包

后续的文件维护很简单，直接对工作空间目录下的文件或者目录进行增加，删除，修改即可，修改完后输入pack打包。

管理端会自动识别到你所做的更改，并记录到更新包里。

即使新旧文件同名，只修改了文件里的数据，也能检测到。目录也是一样，该新增新增，该删除删除，就像对自己电脑上的文件一样操作就好。

::: tip

管理端目前还没有提供复原工作空间目录的指令，如果有这个需求，需要手动从更新包中把文件解压出来。后面会把这个功能加上。

:::

## 七、启动服务端

在终端里使用`mcpatch-manager.exe serve 6700`可以启动内置的服务端，默认端口是6700。

想要关闭服务端可以叉掉终端的窗口，或者按Ctrl + C即可。

内置的服务端使用基于TCP的私有协议，不是http不用担心备案问题，适合小服或者本地调试环境。

## 六、配置客户端

将客户端放到`.minecraft`目录旁边紧挨着，然后直接双击运行。

看到窗口弹出后把它关掉，此时它会生成配置文件`mcpatch.yml`，我们打开编辑。

唯一需要修改的是`urls`选项，这个参数控制更新服务器的地址，将127.0.0.1:6700修改成自己服务器的ip和端口即可。

其它选项可以按需修改，但不是必须的，完成后保存关闭。

## 九、一键启动

每次都要手动运行更新很麻烦，可以借助一些方法在游戏启动时自动进行更新。

首先到[BalloonUpdate/McPatch2Loader](https://github.com/BalloonUpdate/McPatch2Loader/releases)下载最新版的加载器文件。

新建目录`.minecraft/mp`，把刚下载的加载器和客户端程序移动进来。

打开Minecraft启动器（任意启动器均可，官方启动器除外），调整游戏版本设置，找到Java虚拟机参数（或者JVM 参数）。

在参数的开头插入这串代码`-javaagent:mp/loader-1.jar`，然后回到启动器主界面。

接着创建“启动列表”文件`.minecraft/mp/startlist.txt`，将客户端程序的文件名写进去，比如`mcpatch-client-0.0.0.exe`，然后保存关闭。

点击Minecraft启动器的“启动游戏”按钮，一切顺利的话就会自动启动更新了。

## 八、经常被问到的问题

### 文件更新位置

客户端程序会自动搜索.minecraft的父目录作为更新起始位置，到处移动客户端程序不会影响文件更新位置。

如果要调整这个机制，可以修改配置文件里的`base-path`选项

### 删除管理端不存在的文件

客户端有些文件不在工作空间目录中，但又想删掉这个文件，可以在工作空间目录创建一个同路径且同名的空文件。

打一个更新包，然后再将这些文件删掉，再打一个包，客户端就可以正常删除这些不存在的文件了。

### 版本号不是判断版本新旧的依据

版本号只是一个普通的标签，是给人类看的，程序不会解析对比版本号的文字，也不作为任何判断版本前后的依据。

版本号的判断顺序的按打包时间来计算的，后打的版本总是新版本。